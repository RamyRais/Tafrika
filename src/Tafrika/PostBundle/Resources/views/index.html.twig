{% extends "::layout.html.twig" %}
{% block body_javascripts %}
    <div id="fb-root"></div>
    <script src="{{ asset('js/FB_patage.js') }}"></script>
{% endblock %}
{% block body %}

    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            {% for post in posts %}
                {% if post._type == "STATUS" %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="btn-group pull-right">
                                <button type="button" class="btn btn-warning">سنيالي</button>
                                <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <span class="caret"></span>
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li>
                                        <a id="signal_nsfw" href="{{ path('signal_nsfw') }}" data-toggle="tooltip" data-placement="right"
                                           title="سنيالي لحاجات لفيهم كلام زايد ولا قباحة" content="{{ post.id }}">NSFW
                                        </a>
                                    </li>
                                    <li>
                                        <a id="signal_porn" href="{{ path('signal_porn') }}" data-toggle="tooltip" data-placement="right"
                                           title="سنيالي لحاجات لفيهم سكس" content="{{ post.id }}">-18</a>
                                    </li>
                                </ul>
                            </div>
                            <a href="{{ path('status_show', {'status_id': post.id}) }}"><h4>{{ post.title }}</h4></a>
                        </div>
                        <div class="panel-body">
                            {{ post.content }}
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-md-2"><div id="{{ 'count' ~ post.id }}">{{ post.likes }} likes</div></div>
                                <div class="col-md-1">
                                    <button type="button" id="{{ 'up_button' ~ post.id }}" class="btn btn-default  increment up status">
                                        <span class="glyphicon glyphicon-arrow-up" aria-hidden="true" id="like"></span>
                                    </button>
                                </div>
                                <div class="col-md-1">
                                    <button type="button" id="{{ 'down_button' ~ post.id }}" class="btn btn-default  increment down status">
                                        <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                                <div class="col-md-2">
                                    <div class="fb-share-button" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% elseif post._type == "VIDEO" %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="btn-group pull-right">
                                <button type="button" class="btn btn-warning">سنيالي</button>
                                <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <span class="caret"></span>
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li>
                                        <a id="signal_nsfw" href="{{ path('signal_nsfw') }}" data-toggle="tooltip" data-placement="right"
                                           title="سنيالي لحاجات لفيهم كلام زايد ولا قباحة" content="{{ post.id }}">NSFW
                                        </a>
                                    </li>
                                    <li>
                                        <a id="signal_porn" href="{{ path('signal_porn') }}" data-toggle="tooltip" data-placement="right"
                                           title="سنيالي لحاجات لفيهم سكس" content="{{ post.id }}">-18</a>
                                    </li>
                                </ul>
                            </div>
                            <a href="{{ path('video_show', {'video_id':post.id}) }}"><h4>{{ post.title }}</h4></a>
                        </div>
                        <div class="panel panel-body">
                            <div class="embed-responsive embed-responsive-4by3">
                                <iframe class="embed-responsive-item"
                                    src="{{ post.url }}">
                                </iframe>
                            </div>
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-md-2"><div id="{{ 'count' ~ post.id }}">{{ post.likes }} likes</div></div>
                                <div class="col-md-1">
                                    <button type="button" id="{{ 'up_button' ~ post.id }}" class="btn btn-default  increment up video">
                                        <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
                                    </button>
                                </div>
                                <div class="col-md-1">
                                    <button type="button" id="{{ 'down_button' ~ post.id }}" class="btn btn-default  increment down video">
                                        <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                                <div class="col-md-2">
                                    <div class="fb-share-button" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% elseif post._type == "IMAGE" %}
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <div class="btn-group pull-right">
                                <button type="button" class="btn btn-warning">سنيالي</button>
                                <button type="button" class="btn btn-warning dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                    <span class="caret"></span>
                                    <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu" role="menu">
                                    <li>
                                        <a id="signal_nsfw" href="{{ path('signal_nsfw') }}" data-toggle="tooltip" data-placement="right"
                                           title="سنيالي لحاجات لفيهم كلام زايد ولا قباحة" content="{{ post.id }}">NSFW
                                        </a>
                                    </li>
                                    <li>
                                        <a id="signal_porn" href="{{ path('signal_porn') }}" data-toggle="tooltip" data-placement="right"
                                           title="سنيالي لحاجات لفيهم سكس" content="{{ post.id }}">-18</a>
                                    </li>
                                </ul>
                            </div>
                            <a href="{{ path('image_show', {'image_id':post.id}) }}"><h4>{{ post.title }}</h4></a>
                        </div>
                        <div class="panel-body">
                            <img src="{{ asset(post.getWebPath) }}" alt="{{ post.title }}" class="img-responsive">
                        </div>
                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-md-2"><div id="{{ 'count' ~ post.id }}">{{ post.likes }} likes</div></div>
                                <div class="col-md-1">
                                    <button type="button" id="{{ 'up_button' ~ post.id }}" class="btn btn-default  increment up image">
                                        <span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>
                                    </button>
                                </div>
                                <div class="col-md-1">
                                    <button type="button" id="{{ 'down_button' ~ post.id }}" class="btn btn-default increment down image">
                                        <span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>
                                    </button>
                                </div>
                                <div class="col-md-4"></div>
                                <div class="col-md-2">
                                    <div class="fb-share-button" data-href="https://developers.facebook.com/docs/plugins/" data-layout="button"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
            {% endfor %}
            <nav>
                <ul class="pagination">
                    {% if page>1 %}
                        <li>
                            <a href="{{ path('tafrika_index', {'page':page-1}) }}" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                    {% endif %}
                    {% if page-2 > 0 %}
                        <li><a href="{{ path('tafrika_index', {'page':page-2}) }}">{{ page-2 }}</a></li>
                    {% endif %}
                    {% if page-1 > 0 %}
                        <li><a href="{{ path('tafrika_index', {'page':page-1}) }}">{{ page-1 }}</a></li>
                    {% endif %}
                    <li class="active"><a href="#">{{ page }}</a></li>
                    {% if page+1 <= pageNumber %}
                        <li><a href="{{ path('tafrika_index', {'page':page+1}) }}">{{ page+1 }}</a></li>
                    {% endif %}
                    {% if page+2 <= pageNumber %}
                        <li><a href="{{ path('tafrika_index', {'page':page+2}) }}">{{ page+2 }}</a></li>
                    {% endif %}
                    {% if page < pageNumber %}
                        <li>
                            <a href="{{ path('tafrika_index',{'page':page+1}) }}" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="{{ asset('js/signal.js') }}"></script>
    <script>

        $(function(){

            $(".increment").click(function(){


                if($(this).hasClass("up")) {
                    if ($(this).hasClass("video")) {
                        var id = $.parseJSON($(this).attr('id').substr(9));
                        var url = Routing.generate('vote_up_video', {'video_id': id});
                    }else if ($(this).hasClass("image")) {
                        var id = $.parseJSON($(this).attr('id').substr(9));
                        var url = Routing.generate('vote_up_image', {'image_id': id});
                    }else if ($(this).hasClass("status")) {
                        var id = $.parseJSON($(this).attr('id').substr(9));
                        var url = Routing.generate('vote_up_status', {'status_id': id});
                    }
                        $.ajax({
                        type: "POST",
                        url: url,
                        data: $("#thumbs_up").serialize(),
                        success: function (data) {
                            up="up_button";
                            down="down_button";
                            count=" #count";
                            if (data.button == "up_button") {
                                document.getElementById(up.concat(id)).style.background = '#337ab7';
                                document.getElementById(down.concat(id)).style.background = '#ffffff';
                            } else {
                                document.getElementById(up.concat(id)).style.background = '#ffffff';
                                document.getElementById(down.concat(id)).style.background = '#ffffff';
                            }
                            $(count.concat(id)).load(document.URL + count.concat(id));

                        }
                    });


                } else {
                    if ($(this).hasClass("video")) {
                        var id = $.parseJSON($(this).attr('id').substr(11));
                        var url = Routing.generate('vote_down_video', {'video_id': id});
                    }else if ($(this).hasClass("image")) {
                        var id = $.parseJSON($(this).attr('id').substr(11));
                        var url = Routing.generate('vote_down_image', {'image_id': id});
                    }else if ($(this).hasClass("status")) {
                        var id = $.parseJSON($(this).attr('id').substr(11));
                        var url = Routing.generate('vote_down_status', {'status_id': id});
                    }
                        $.ajax({
                            type: "POST",
                            url: url,
                            data: $("#thumbs_up").serialize(),
                            success: function (data) {
                                up = "up_button";
                                down = "down_button";
                                count=" #count";
                                if (data.button == "down_button") {
                                    document.getElementById(down.concat(id)).style.background = '#337ab7';
                                    document.getElementById(up.concat(id)).style.background = '#ffffff';
                                } else {
                                    document.getElementById(up.concat(id)).style.background = '#ffffff';
                                    document.getElementById(down.concat(id)).style.background = '#ffffff';
                                }
                                $(count.concat(id)).load(document.URL + count.concat(id));

                            }
                        });


                }

                $(this).parent().addClass("bump");

                setTimeout(function(){
                    $(this).parent().removeClass("bump");
                }, 400);
            });
        });


        window.onload = function() {
            {% for vote in votes %}
            if(({{ vote.vote }})==1) {
                document.getElementById("{{ 'up_button' ~ vote.post.id }}").style.background = '#337ab7';
            }
            else {
                document.getElementById("{{ 'down_button' ~ vote.post.id }}").style.background = '#337ab7';
            }
            {% endfor %}

        }
    </script>
{% endblock %}